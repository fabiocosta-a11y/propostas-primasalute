<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de Propostas - Prima Salute</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { text-align: center; margin-bottom: 30px; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .logo { width: 200px; height: 80px; margin: 0 auto 20px; }
        .logo img { width: 100%; height: 100%; object-fit: contain; }
        h1 { color: #E63946; font-size: 28px; margin-bottom: 10px; }
        .subtitle { color: #666; font-size: 14px; }
        .form-section { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .form-title { color: #E63946; font-size: 18px; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid #E63946; }
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; color: #333; font-weight: bold; font-size: 14px; }
        input, select { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 14px; }
        .row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .row-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; }
        .btn-generate { background: #E63946; color: white; border: none; padding: 18px 40px; border-radius: 10px; cursor: pointer; font-size: 18px; font-weight: bold; width: 100%; margin-top: 20px; }
        .btn-generate:hover { background: #d62839; }
        .btn-generate:disabled { background: #ccc; cursor: not-allowed; }
        .loading { display: none; text-align: center; padding: 20px; background: #fff3cd; border-radius: 8px; margin-top: 20px; }
        .loading.show { display: block; }
        .item-row { display: grid; grid-template-columns: 40px 90px 2fr 70px 120px 120px 45px; gap: 8px; margin-bottom: 15px; padding: 15px; background: #f9f9f9; border-radius: 8px; }
        .btn-add { background: #28a745; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; margin-top: 10px; }
        .btn-remove { background: #dc3545; color: white; border: none; padding: 10px; border-radius: 5px; cursor: pointer; font-size: 18px; height: 42px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">
                <img src="https://primasalute.com.br/wp-content/uploads/2025/11/prima-salute-logo-site.png" alt="Prima Salute">
            </div>
            <h1>GERADOR DE PROPOSTAS</h1>
            <p class="subtitle">‚ú® Vers√£o Profissional com Qualidade Perfeita ‚ú®</p>
        </div>
        
        <div class="form-section">
            <h2 class="form-title">üìã Dados da Proposta</h2>
            <div class="row">
                <div class="form-group">
                    <label>N√∫mero da Proposta:</label>
                    <input type="text" id="numeroProposta" value="1728/26">
                </div>
                <div class="form-group">
                    <label>Data:</label>
                    <input type="date" id="dataProposta">
                </div>
            </div>
            <div class="row-3">
                <div class="form-group">
                    <label>Vendedor Assistente:</label>
                    <input type="text" id="vendedorAssistente">
                </div>
                <div class="form-group">
                    <label>Comercial:</label>
                    <input type="text" id="comercial" value="Regiane Lisboa">
                </div>
                <div class="form-group">
                    <label>Telefone:</label>
                    <input type="text" id="telefoneVenda" value="11">
                </div>
            </div>
            
            <h2 class="form-title" style="margin-top: 30px;">üè• Dados do Cliente</h2>
            <div class="form-group">
                <label>Nome do Cliente:</label>
                <input type="text" id="nomeCliente" required>
            </div>
            <div class="row">
                <div class="form-group">
                    <label>CNPJ:</label>
                    <input type="text" id="cnpjCliente">
                </div>
                <div class="form-group">
                    <label>IE:</label>
                    <input type="text" id="ieCliente">
                </div>
            </div>
            <div class="form-group">
                <label>Contato:</label>
                <input type="text" id="contatoCliente">
            </div>
            <div class="row">
                <div class="form-group">
                    <label>Cargo:</label>
                    <input type="text" id="cargoCliente">
                </div>
                <div class="form-group">
                    <label>Email:</label>
                    <input type="text" id="emailCliente">
                </div>
            </div>
            <div class="form-group">
                <label>Telefone:</label>
                <input type="text" id="telefoneCliente">
            </div>
            
            <h2 class="form-title" style="margin-top: 30px;">üìç Endere√ßos</h2>
            <div class="row">
                <div>
                    <label><strong>Faturamento:</strong></label>
                    <input type="text" id="ruaFaturamento" placeholder="Rua" style="margin-bottom:10px;">
                    <input type="text" id="bairroFaturamento" placeholder="Bairro" style="margin-bottom:10px;">
                    <div style="display:grid;grid-template-columns:2fr 1fr;gap:10px;">
                        <input type="text" id="cidadeFaturamento" placeholder="Cidade">
                        <input type="text" id="estadoFaturamento" placeholder="UF">
                    </div>
                    <input type="text" id="cepFaturamento" placeholder="CEP" style="margin-top:10px;">
                </div>
                <div>
                    <label><strong>Entrega:</strong></label>
                    <input type="text" id="ruaEntrega" placeholder="Rua" style="margin-bottom:10px;">
                    <input type="text" id="bairroEntrega" placeholder="Bairro" style="margin-bottom:10px;">
                    <div style="display:grid;grid-template-columns:2fr 1fr;gap:10px;">
                        <input type="text" id="cidadeEntrega" placeholder="Cidade">
                        <input type="text" id="estadoEntrega" placeholder="UF">
                    </div>
                    <input type="text" id="cepEntrega" placeholder="CEP" style="margin-top:10px;">
                </div>
            </div>
            
            <h2 class="form-title" style="margin-top: 30px;">üõí Produtos</h2>
            <div id="produtosContainer"></div>
            <button class="btn-add" onclick="adicionarProduto()">+ Adicionar Produto</button>
            
            <h2 class="form-title" style="margin-top: 30px;">üìã Informa√ß√µes Adicionais</h2>
            <div class="row">
                <div class="form-group">
                    <label>Frete:</label>
                    <input type="text" id="frete" value="CIF">
                </div>
                <div class="form-group">
                    <label>Previs√£o de Entrega:</label>
                    <input type="text" id="entrega" value="90 dias">
                </div>
            </div>
            <div class="row">
                <div class="form-group">
                    <label>Prazo de Pagamento:</label>
                    <input type="text" id="prazoPagamento" value="10 dias">
                </div>
                <div class="form-group">
                    <label>Forma de Pagamento:</label>
                    <input type="text" id="pagamento" value="Dep. Banc√°rio">
                </div>
            </div>
            <div class="row">
                <div class="form-group">
                    <label>Validade da Proposta:</label>
                    <input type="text" id="validade" value="30 dias">
                </div>
                <div class="form-group">
                    <label>Transportadora:</label>
                    <input type="text" id="transportadora" value="TNT Merc√∫rio Cargas e Encomendas Expressas Ltda.">
                </div>
            </div>
            
            <button class="btn-generate" onclick="gerarPDF()" id="btnGerar">üöÄ GERAR PDF PROFISSIONAL</button>
            <div class="loading" id="loading">‚è≥ Gerando PDF em alta qualidade no servidor... Aguarde...</div>
        </div>
    </div>
    
    <script>
const baseProdutos = {
    '233': {nome: 'SISTEMA DE HIPO-HIPERTERMIA BLANKETROL III', marca: 'Gentherm', valor: 240000.00, ref: 'REF. 233'},
    '196': {nome: 'COLCHAO TERMICO TAMANHO ADULTO PLASTIPAD', marca: 'Gentherm', valor: 6200.00, ref: '61CM X 152,4 CM'},
    '194': {nome: 'COLCHAO TERMICO TAMANHO PEDIATRICO PLASTIPAD', marca: 'Gentherm', valor: 6200.00, ref: '55.9 CM X 76.2 CM'},
    '193': {nome: 'COLCHAO TERMICO TAMANHO INFANTIL PLASTIPAD', marca: 'Gentherm', valor: 6200.00, ref: '30.5 CM X 45.7 CM'},
    'DUO310BR-COMPLETO': {nome: 'SISTEMA DE AQUECIMENTO ASTOPAD DUO 310 C/ 1 COLCHAO COV150 (COMPLETO)', marca: 'Stihler/Gentherm', valor: 49000.00, ref: 'DUO310BR'},
    'DUO310BR': {nome: 'SISTEMA DE AQUECIMENTO ASTOPAD DUO 310 (SOMENTE APARELHO)', marca: 'Stihler/Gentherm', valor: 35000.00, ref: 'DUO310BR'},
    'COV070': {nome: 'COLCHAO REUTILIZAVEL P/ ASTOPAD 68X48CM (NEO)', marca: 'Stihler/Gentherm', valor: 14000.00, ref: 'COV070'},
    'COV105': {nome: 'COLCHAO REUTILIZAVEL P/ ASTOPAD 105CMX50CM (MEIO CORPO)', marca: 'Stihler/Gentherm', valor: 14000.00, ref: 'COV105'},
    'COV150': {nome: 'COLCHAO REUTILIZAVEL P/ ASTOPAD 150CMX50CM (ADULTO)', marca: 'Stihler/Gentherm', valor: 14000.00, ref: 'COV150'},
    'COV155': {nome: 'COLCHAO REUTILIZAVEL P/ ASTOPAD 150CMX50CM (MEMBROS SUPERIORES)', marca: 'Stihler/Gentherm', valor: 13000.00, ref: 'COV155'},
    'COV180': {nome: 'COLCHAO REUTILIZAVEL P/ ASTOPAD 180CMX50CM (ADULTO GRANDE)', marca: 'Stihler/Gentherm', valor: 14500.00, ref: 'COV180'},
    'AFP300BR': {nome: 'AQUECEDOR DE SANGUE E FLUIDOS ASTOFLO PLUS ECO', marca: 'Stihler/Gentherm', valor: 25600.00, ref: 'AFP300BR'},
    'AP220SBR': {nome: 'AQUECEDOR DE SANGUE E FLUIDOS ASTOTHERM PLUS 4MM', marca: 'Stihler/Gentherm', valor: 28900.00, ref: 'AP220SBR'},
    'TMS-W101': {nome: 'UNIDADE DE AQUECIMENTO DE MANTA T√âRMICA TMS-W101', marca: 'Tappa', valor: 9500.00, ref: 'TMS-W101'},
    'MANTAS-TAPPA': {nome: 'MANTAS TAPPA (TODOS OS MODELOS) - N√ÉO ESTERIL', marca: 'Tappa', valor: 65.00, ref: 'DIVERSOS'},
    '135': {
        nome: 'SISTEMA DE AQUECIMENTO DE MANTA T√âRMICA MODELO WARM AIR 135 220V - GENTHERM', 
        marca: 'Gentherm', 
        valor: 13990.00, 
        ref: 'REF. 135',
        imagem: 'https://primasalute.com.br/wp-content/uploads/2026/01/zvNreuag.jpeg',
        caracteristicas: [
            '‚Ä¢ 4 n√≠veis de temperatura',
            '‚Ä¢ Equipamento compacto e leve',
            '‚Ä¢ Alarmes de temperatura alta e baixa',
            '‚Ä¢ Versatilidade em mantas descart√°veis, pedi√°trico, adulto e neonatal',
            '‚Ä¢ Indica√ß√£o de horas de uso antes da manuten√ß√£o'
        ],
        incluso: 'Incluso: 10 Mantas T√©rmicas Tam. Adulto',
        origem: 'Origem: EUA - Fabricante: Gentherm Medical, LLC - USA',
        registro: 'Registro ANVISA 80271299007'
    },
    '3227': {nome: 'SUPORTE AUXILIAR C/ RODIZIOS P/ WARM AIR', marca: 'Gentherm', valor: 990.00, ref: 'REF. 3227'},
    '243-UNIT': {nome: 'MANTA TERMICA DESC. FILTEREDFLO ADULTO CORPO INTEIRO', marca: 'Gentherm', valor: 65.00, ref: 'REF. 243'},
    '443-UNIT': {nome: 'MANTA TERMICA DESC. FILTEREDFLO MEIO CORPO SUPERIOR', marca: 'Gentherm', valor: 65.00, ref: 'REF. 443'},
    '442-UNIT': {nome: 'MANTA TERMICA DESC. FILTEREDFLO MEIO CORPO INFERIOR', marca: 'Gentherm', valor: 65.00, ref: 'REF. 442'},
    '244-UNIT': {nome: 'MANTA TERMICA DESC. FILTEREDFLO PEDIATRICA CORPO INTEIRO', marca: 'Gentherm', valor: 74.00, ref: 'REF. 244'},
    '248-UNIT': {nome: 'MANTA TERMICA DESC. FILTEREDFLO ADULTO P/ USO SOB O CORPO', marca: 'Gentherm', valor: 84.00, ref: 'REF. 248'},
    '247-UNIT': {nome: 'MANTA TERMICA DESC. FILTEREDFLO PEDIATRICA P/ USO SOB O CORPO', marca: 'Gentherm', valor: 84.00, ref: 'REF. 247'},
    '246-UNIT': {nome: 'MANTA TERMICA DESC. FILTEREDFLO NEONATAL P/ USO SOB O CORPO', marca: 'Gentherm', valor: 80.00, ref: 'REF. 246'},
    '344': {nome: 'MANTA TERMICA DESC. FILTEREDFLO TORSO', marca: 'Gentherm', valor: 100.00, ref: 'REF. 344'},
    '243': {nome: 'MANTA TERMICA DESC. FILTEREDFLO ADULTO CORPO INTEIRO REF. 243 - CAIXA COM 10 UNIDADES', marca: 'Gentherm', valor: 800.00, ref: 'REF. 243'},
    '442': {nome: 'MANTA TERMICA DESC. FILTEREDFLO MEIO CORPO INFERIOR REF. 442 - CAIXA C/ 10 UNIDADES', marca: 'Gentherm', valor: 800.00, ref: 'REF. 442'},
    '443': {nome: 'MANTA TERMICA DESC. FILTEREDFLO MEIO CORPO SUPERIOR REF. 443 - CAIXA C/ 10 UNIDADES', marca: 'Gentherm', valor: 800.00, ref: 'REF. 443'},
    '244': {nome: 'MANTA TERMICA DESC. FILTEREDFLO PEDIATRICA CORPO INTEIRO REF. 244 - CAIXA C/ 10 UNIDADES', marca: 'Gentherm', valor: 800.00, ref: 'REF. 244'},
    '248': {nome: 'MANTA TERMICA DESC. FILTEREDFLO ADULTO P/ USO SOB O CORPO REF. 248 - CAIXA C/ 10 UNIDADES', marca: 'Gentherm', valor: 900.00, ref: 'REF. 248'},
    '247': {nome: 'MANTA TERMICA DESC. FILTEREDFLO PEDIATRICA PARA USO SOB O CORPO REF. 247 - CAIXA C/ 10 UNIDADES', marca: 'Gentherm', valor: 950.00, ref: 'REF. 247'},
    '246': {nome: 'MANTA TERMICA DESC. FILTEREDFLO NEONATAL REF. 246 - CAIXA C/ 10 UNIDADES', marca: 'Gentherm', valor: 850.00, ref: 'REF. 246'},
    'TMS-W101-TAPPA': {nome: 'UNIDADE DE AQUECIMENTO DE MANTA T√âRMICA TMS-W101', marca: 'Tappa', valor: 9900.00, ref: 'TMS-W101'},
    'WB-1101-N': {nome: 'MANTA TERMICA DESC. ADULTO CORPO INTEIRO', marca: 'Tappa', valor: 650.00, ref: 'WB-1101-N - CAIXA C/ 10 UNIDADES'},
    'WB-1104-N': {nome: 'MANTA TERMICA DESC. MEMBROS INFERIORES', marca: 'Tappa', valor: 650.00, ref: 'WB-1104-N - CAIXA C/ 10 UNIDADES'},
    'WB-1103-N': {nome: 'MANTA TERMICA DESC. MEMBROS SUPERIORES', marca: 'Tappa', valor: 650.00, ref: 'WB-1103-N - CAIXA C/ 10 UNIDADES'},
    'WB-2101-N': {nome: 'MANTA TERMICA DESC. PEDIATRICA CORPO INTEIRO', marca: 'Tappa', valor: 650.00, ref: 'WB-2101-N - CAIXA C/ 10 UNIDADES'},
    'WB-1201-N': {nome: 'MANTA TERMICA DESC. ADULTO SOB O CORPO', marca: 'Tappa', valor: 650.00, ref: 'WB-1201-N - CAIXA C/ 10 UNIDADES'},
    'WB-2202-N': {nome: 'MANTA TERMICA DESC. PEDIATRICA SOB O CORPO', marca: 'Tappa', valor: 650.00, ref: 'WB-2202-N - CAIXA C/ 10 UNIDADES'},
    'WB-2201-N': {nome: 'MANTA TERMICA DESC. NEONATAL SOB O CORPO', marca: 'Tappa', valor: 650.00, ref: 'WB-2201-N - CAIXA C/ 10 UNIDADES'}
};
        };
        
        let contadorProdutos = 0;
        document.getElementById('dataProposta').valueAsDate = new Date();
        window.onload = function() { adicionarProduto(); };
        
        function adicionarProduto() {
            contadorProdutos++;
            const container = document.getElementById('produtosContainer');
            const itemRow = document.createElement('div');
            itemRow.className = 'item-row';
            itemRow.id = 'item-' + contadorProdutos;
            
            let optionsHTML = '<option value="">-- Selecione --</option>';
            for (const [codigo, produto] of Object.entries(baseProdutos)) {
                optionsHTML += `<option value="${codigo}">${codigo} - ${produto.nome.substring(0,50)}...</option>`;
            }
            
            itemRow.innerHTML = `
                <input type="text" value="${String(contadorProdutos).padStart(2, '0')}" readonly style="text-align:center; background:#eee;">
                <input type="text" class="codigo-produto" readonly style="background:#f0f0f0; text-align:center;">
                <select class="produto-select" onchange="selecionarProduto(${contadorProdutos}, this.value)">${optionsHTML}</select>
                <input type="number" class="quantidade" value="1" min="1" style="text-align:center;">
                <input type="text" class="valorUnitario" readonly style="background:#e8f5e9; text-align:right;">
                <input type="text" class="valorTotal" readonly style="background:#fff3cd; text-align:right; font-weight:bold;">
                <button class="btn-remove" onclick="removerProduto(${contadorProdutos})">√ó</button>
            `;
            container.appendChild(itemRow);
        }
        
        function selecionarProduto(id, codigo) {
            if (!codigo) return;
            const produto = baseProdutos[codigo];
            const item = document.getElementById('item-' + id);
            item.querySelector('.codigo-produto').value = codigo;
            item.querySelector('.valorUnitario').value = 'R$ ' + produto.valor.toFixed(2).replace('.', ',');
            item.dataset.codigo = codigo;
            item.dataset.produto = JSON.stringify(produto);
            atualizarValorTotal(id);
        }
        
        function atualizarValorTotal(id) {
            const item = document.getElementById('item-' + id);
            const produto = JSON.parse(item.dataset.produto || '{}');
            const quantidade = parseFloat(item.querySelector('.quantidade').value) || 0;
            const total = produto.valor * quantidade;
            item.querySelector('.valorTotal').value = 'R$ ' + total.toFixed(2).replace('.', ',');
        }
        
        function removerProduto(id) {
            document.getElementById('item-' + id)?.remove();
        }
        
        async function gerarPDF() {
            const nomeCliente = document.getElementById('nomeCliente').value;
            if (!nomeCliente) {
                alert('‚ö†Ô∏è Preencha o nome do cliente!');
                return;
            }
            
            // Coletar produtos
            const items = document.querySelectorAll('.item-row');
            const produtos = [];
            items.forEach(item => {
                const select = item.querySelector('.produto-select');
                if (!select.value) return;
                
                const produtoData = JSON.parse(item.dataset.produto);
                const quantidade = parseInt(item.querySelector('.quantidade').value);
                
                produtos.push({
                    codigo: item.dataset.codigo,
                    nome: produtoData.nome,
                    marca: produtoData.marca,
                    valorUnitario: produtoData.valor,
                    quantidade: quantidade,
                    imagem: produtoData.imagem,
                    caracteristicas: produtoData.caracteristicas,
                    incluso: produtoData.incluso,
                    origem: produtoData.origem,
                    registro: produtoData.registro
                });
            });
            
            if (produtos.length === 0) {
                alert('‚ö†Ô∏è Adicione pelo menos um produto!');
                return;
            }
            
            const dados = {
                numeroProposta: document.getElementById('numeroProposta').value,
                dataProposta: document.getElementById('dataProposta').value,
                comercial: document.getElementById('comercial').value,
                telefoneVenda: document.getElementById('telefoneVenda').value,
                nomeCliente: nomeCliente,
                cnpjCliente: document.getElementById('cnpjCliente').value,
                ieCliente: document.getElementById('ieCliente').value,
                contatoCliente: document.getElementById('contatoCliente').value,
                cargoCliente: document.getElementById('cargoCliente').value,
                emailCliente: document.getElementById('emailCliente').value,
                telefoneCliente: document.getElementById('telefoneCliente').value,
                ruaFaturamento: document.getElementById('ruaFaturamento').value,
                bairroFaturamento: document.getElementById('bairroFaturamento').value,
                cidadeFaturamento: document.getElementById('cidadeFaturamento').value,
                estadoFaturamento: document.getElementById('estadoFaturamento').value,
                cepFaturamento: document.getElementById('cepFaturamento').value,
                ruaEntrega: document.getElementById('ruaEntrega').value,
                bairroEntrega: document.getElementById('bairroEntrega').value,
                cidadeEntrega: document.getElementById('cidadeEntrega').value,
                estadoEntrega: document.getElementById('estadoEntrega').value,
                cepEntrega: document.getElementById('cepEntrega').value,
                frete: document.getElementById('frete').value,
                entrega: document.getElementById('entrega').value,
                prazoPagamento: document.getElementById('prazoPagamento').value,
                pagamento: document.getElementById('pagamento').value,
                validade: document.getElementById('validade').value,
                transportadora: document.getElementById('transportadora').value,
                produtos: produtos
            };
            
            document.getElementById('loading').classList.add('show');
            document.getElementById('btnGerar').disabled = true;
            
            try {
                const response = await fetch('/api/gerar-pdf', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(dados)
                });
                
                if (!response.ok) throw new Error('Erro ao gerar PDF');
                
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `Proposta_${dados.numeroProposta.replace('/', '-')}_${dados.nomeCliente}.pdf`;
                a.click();
                
                alert('‚úÖ PDF gerado com QUALIDADE PERFEITA!');
            } catch (error) {
                alert('‚ùå Erro: ' + error.message);
            } finally {
                document.getElementById('loading').classList.remove('show');
                document.getElementById('btnGerar').disabled = false;
            }
        }
    </script>
</body>
</html>
